<!-- empleados.html -->
<div class="container mt-4">
    <h1 class="text-center mb-4">Trabajadores - UNC</h1>

    <!-- Fila de Botones y Barra de Búsqueda -->
    <div class="row mb-3">
        <div class="col-md-8">
            <!-- Barra de búsqueda -->
            <input type="text" id="search-bar" class="form-control" placeholder="Buscar trabajador..."
                onkeyup="searchWorkers()">
        </div>
        <div class="col-md-4 text-end">
            <!-- Botón para Agregar Usuario -->
            <button class="btn btn-success" onclick="addUser()">
                <i class="fas fa-user-plus"></i> Agregar Usuario
            </button>
        </div>
    </div>

    <!-- Tabla de empleados -->
    <table class="table table-striped table-bordered" id="empleados-table">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Cargo</th>
                <th>Sueldo</th>
                <th>Fecha de Contratación</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="empleados-tbody">
            <!-- Aquí se insertarán los datos dinámicamente -->
        </tbody>
    </table>

    <!-- Paginación (aunque aún no la implementes completamente) -->
    <nav>
        <ul class="pagination justify-content-center" id="pagination">
            <!-- Los enlaces de paginación se generarán dinámicamente -->
        </ul>
    </nav>
</div>

<script>
    // Variable para almacenar la página actual
    let currentPage = 1;
    const limit = 10; // Definir el límite de resultados por página

    const token = localStorage.getItem('token');
    const loadingOverlay = document.getElementById('loading-overlay'); // Asumimos que tienes un overlay de carga

    // Función para cargar los trabajadores
    function loadWorkers(workers) {
        const tbody = document.getElementById('empleados-tbody');
        tbody.innerHTML = ''; // Limpiar la tabla antes de agregar nuevos datos

        workers.forEach(worker => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${worker.id}</td>
                <td>${worker.first_name}</td>
                <td>${worker.last_name}</td>
                <td>${worker.position}</td>
                <td>${worker.salary}</td>
                <td>${worker.hire_date}</td>
                <td>${worker.status}</td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="editUser(${worker.id})"><i class="fas fa-edit"></i> Editar</button>
                    <button class="btn btn-danger btn-sm" onclick="archiveUser(${worker.id})"><i class="fas fa-archive"></i> Archivar</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Función para obtener los datos de la API usando AJAX
    function fetchData() {
        if (!token) {
            console.error('Token no encontrado. El usuario no está autenticado.');
            return; // Si no hay token, no realizamos la solicitud
        }

        // Realizar la solicitud AJAX a la API, incluyendo el token en el encabezado
        $.ajax({
            url: `http://192.168.1.8/auditoria/works/?page=${currentPage}&limit=${limit}`,
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,  // Agregar el token en el encabezado
                'Content-Type': 'application/json'  // Especificamos que el contenido de la respuesta es JSON
            },
            success: function (data) {
                loadWorkers(data.workers); // Usar data.workers que contiene los trabajadores // Ocultar el overlay de carga
                console.log(data.workers);

            },
            error: function () {
                console.error('Error al cargar los trabajadores'); // Ocultar el overlay de carga
            }
        });
    }

    // Función de búsqueda
    function searchWorkers() {
        const searchTerm = document.getElementById('search-bar').value.toLowerCase();
        const rows = document.querySelectorAll('#empleados-tbody tr');
        rows.forEach(row => {
            const cells = row.getElementsByTagName('td');
            const fullName = `${cells[1].textContent} ${cells[2].textContent}`.toLowerCase(); // Nombre y Apellido
            if (fullName.indexOf(searchTerm) > -1) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    // Función para agregar un usuario (solo ejemplo, funcionalidad no implementada)
    function addUser() {
        alert('Funcionalidad para agregar usuario no implementada aún.');
    }

    // Función para editar un usuario (solo ejemplo, funcionalidad no implementada)
    function editUser(id) {
        alert(`Editar usuario con ID: ${id}`);
    }

    // Función para archivar un usuario (solo ejemplo, funcionalidad no implementada)
    function archiveUser(id) {
        alert(`Archivar usuario con ID: ${id}`);
    }

    // Llamar a fetchData para obtener los datos cuando la página se carga
    $(document).ready(function () {
        fetchData();
    });
</script>