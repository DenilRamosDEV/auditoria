<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de RRHH</title>
    <!-- Vincula el archivo de Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Vincula el archivo de jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Vincula los iconos de Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        /* Barra lateral */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 250px;
            background-color: #343a40;
            padding-top: 20px;
            z-index: 1000;
            transition: width 0.3s ease;
        }

        .sidebar a {
            color: white;
            padding: 12px 15px;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
        }

        .sidebar a:hover {
            background-color: #575757;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .sidebar a.active {
            background-color: #007bff;
        }

        .sidebar i {
            margin-right: 10px;
        }

        /* Estilo del contenido principal */
        .content {
            margin-left: 260px;
            padding: 20px;
        }

        /* Estilo para el botón del usuario */
        .user-info-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .user-info-btn:hover {
            background-color: #0056b3;
        }

        .user-details {
            display: none;
            position: absolute;
            top: 60px;
            right: 20px;
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 250px;
            z-index: 9999;
        }

        /* Estilos para el perfil de usuario */
        .sidebar .user-profile {
            text-align: center;
            padding: 15px;
            color: white;
            border-bottom: 1px solid #575757;
        }

        .sidebar .user-profile img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <!-- Barra de navegación lateral -->
    <div class="sidebar">
        <div class="user-profile">
            <img src="./img/profile.jpg" alt="Perfil de Usuario">
            <p id="user-name">Juan Pérez</p>
            <small id="user-role">Administrador</small>
        </div>
        <h4 class="text-white text-center">RRHH - UNC</h4>
        <a href="#" data-page="empleados" class="nav-link"><i class="fas fa-users"></i> Empleados</a>
        <a href="#" data-page="gestion" class="nav-link"><i class="fas fa-cogs"></i> Gestión</a>
        <a href="#" data-page="informes" class="nav-link"><i class="fas fa-chart-line"></i> Informes</a>
    </div>

    <!-- Botón para ver los datos del usuario -->
    <button class="user-info-btn" id="user-btn">Perfil</button>

    <!-- Detalles del usuario -->
    <div class="user-details" id="user-details">
        <h5>Datos del Usuario</h5>
        <p><strong>Nombre:</strong> <span id="user-name"></span></p>
        <p><strong>Rol:</strong> <span id="user-role"></span></p>
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>ID de Usuario:</strong> <span id="user-id"></span></p>
        <button class="btn btn-secondary" onclick="toggleUserDetails()">Cerrar</button>
        <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
    </div>

    <!-- Contenido principal -->
    <div class="content" id="main-content">
        <!-- Panel de Bienvenida -->
        <h1>Bienvenido al Sistema de Gestión de RRHH</h1>
        <p>Gestiona a tu equipo y mantén el control de todos los aspectos relacionados con el personal.</p>

        <!-- Panel de Información del Usuario -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title name_user">Hola, usuarios</h5>
                <p>
                    <strong>Rol:</strong>
                    <sap class="rol_user"></sap>
                </p>
                <p><strong>E-mial:</strong> <span class="email_user"></span></p>
            </div>
        </div>

        <!-- Resumen de Empleados -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title">Total de Trabajadores</h5>
                        <p class="card-text"><span id="total_works"></span> trabajadores totales</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title">Trabajadores Activos</h5>
                        <p class="card-text"><span id="avtive_works"></span> trabajadores activos</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h5 class="card-title">Trabajadores Inactivos</h5>
                        <p class="card-text"><span id="inactive_works"></span> trabajadores inactivos</p>
                    </div>
                </div>
            </div>
        </div>

        <h3>Descripción del Sistema</h3>
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Sistema de Gestión de Recursos Humanos</h5>
                        <p class="card-text">
                            El Sistema de Gestión de Recursos Humanos de la Universidad Nacional de Cajamarca está
                            diseñado para optimizar la administración del personal de la universidad. Con este sistema,
                            se pueden gestionar los siguientes aspectos:
                        </p>
                        <ul>
                            <li><strong>Trabajadores:</strong> Registro y seguimiento de la información del personal
                                administrativo.</li>
                            <li><strong>Trabajadores Activos:</strong> son los usuarios o trabajadopres que se
                                encuiantran activos hasta la fecha.</li>
                            <li><strong>Trabajadores Inactivos:</strong> Son usuarios o trabajadpores que ya no son
                                parte de la universidad.</li>
                        </ul>
                        <p class="card-text">
                            Este sistema permite una gestión más eficiente y transparente de los recursos humanos,
                            mejorando la organización y facilitando el acceso a la información clave.
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script>
        // Obtener datos del usuario desde localStorage
        function getUserData() {
            return JSON.parse(localStorage.getItem('user'));
        }

        // Rellenar los datos del usuario en la interfaz
        function fillUserDetails() {
            var user = getUserData();

            if (user) {
                $('.name_user').text(`Bienvenido: ${user.username}`);
                $('.rol_user').text(user.role);
                $('.email_user').text(user.email);

                $('#user-name').text(user.username);
                $('#user-role').text(user.role);
                $('#user-email').text(user.email);
                $('#user-id').text(user.id);
            } else {
                $('.name_user').text('No disponible');
                $('.rol_user').text('No disponible');
                $('.email_user').text('No disponible');

                $('#user-name').text('No disponible');
                $('#user-role').text('No disponible');
                $('#user-email').text('No disponible');
                $('#user-id').text('No disponible');
            }
        }

        // Función para mostrar u ocultar los detalles del usuario
        function toggleUserDetails() {
            $('#user-details').toggle();
        }

        // Mostrar detalles del usuario al hacer clic en el botón
        $('#user-btn').on('click', function () {
            toggleUserDetails();
        });

        // Llamar a la función para rellenar los detalles del usuario cuando se carga la página
        $(document).ready(function () {
            fillUserDetails();
            getDatos();
        });
        function logout() {
            // Elimina los datos de sesión, por ejemplo el token
            localStorage.removeItem('token');
            localStorage.removeItem('user');

            // Redirige al index.html
            window.location.href = 'index.html';
        }

        function getDatos() {
            const token = localStorage.getItem('token');
            console.log(token);
            $.ajax({
                url: 'http://192.168.1.8/auditoria/works/?count=1',  // La URL del archivo HTML a cargar
                method: 'GET',  // Método de la solicitud
                headers: {
                    'Authorization': `Bearer ${token}`,  // Pasando el token en el encabezado
                    'Content-Type': 'application/json'  // Especificando el tipo de contenido
                },
                success: function (response) {
                    console.log(response);
                    $('#total_works').text(response.total_count);
                    $('#avtive_works').text(response.active_count);
                    $('#inactive_works').text(response.inactive_count);

                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

        // Event listener para los enlaces en la barra lateral
        $('.sidebar a').on('click', function (e) {
            e.preventDefault();  // Evita que se recargue la página

            // Obtén el valor del atributo data-page
            var page = $(this).data('page');

            // Realiza una solicitud AJAX
            $.ajax({
                url: page + '.html',  // La URL del archivo HTML a cargar
                method: 'GET',  // Método de la solicitud
                success: function (response) {
                    // Inserta el contenido obtenido en el div principal
                    $('#main-content').html(response);
                },
                error: function () {
                    $('#main-content').html('<p>Error al cargar el contenido.</p>');
                }
            });
        });
    </script>
    <!-- <script src="./empleados.js"></script> -->

</body>

</html>